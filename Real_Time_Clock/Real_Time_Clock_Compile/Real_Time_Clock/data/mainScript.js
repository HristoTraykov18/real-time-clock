document.getElementsByTagName("body")[0].onload = function() { RequestUserSettings(); document.getElementsByTagName("form")[0].addEventListener("submit", SubmitChanges); document.getElementById("js-auto-set-option").addEventListener("click", ShowAutoSettings); document.getElementById("js-manual-set-option").addEventListener("click", ShowManualSettings); document.getElementById("js-password-button-container").addEventListener("click", TogglePasswordVisibility); let decreaseButtons = document.getElementsByClassName("decrease-button"); let increaseButtons = document.getElementsByClassName("increase-button"); for (let i = 0; i < increaseButtons.length; i++) { decreaseButtons[i].addEventListener("click", function() { DecreaseTime(i, this); }); increaseButtons[i].addEventListener("click", function() { IncreaseTime(i, this); }); } document.getElementById("js-brightness-control-label").addEventListener("click", ToggleSliderInput); let sliderInput = document.getElementById("js-slider-input"); let sliderThumb = document.getElementById("js-slider-thumb"); sliderInput.addEventListener("input", function() { UpdateSlider(this, sliderThumb, sliderThumb.scrollWidth); }); sliderInput.addEventListener("change", function() { UpdateSlider(this, sliderThumb, sliderThumb.scrollWidth); }); document.getElementById("js-popup-button").addEventListener("click", CloseStatusPopup); }; function CloseStatusPopup() { document.getElementById("js-popup-container").classList.remove("show-popup"); document.getElementById("js-popup-message").innerText = ""; } function DecreaseTime(i, clickedButton) { clickedButton.style.borderTopColor = "var(--pale-purple)"; setTimeout(function() { clickedButton.style.borderTopColor = "var(--red)"; }, 150); let clockDigits = document.getElementsByClassName("clock-digit"); let number = parseInt(clockDigits[i].value) - 1; if (i == 0) { if (number == -1) number = 2; if (number == 2) { let secondDigit = clockDigits[1].value; if (secondDigit > 3) clockDigits[1].value = "0"; } } else if (i == 1) { let firstDigit = parseInt(clockDigits[0].value); if (firstDigit < 2 && number === -1) number = 9; else if (firstDigit === 2 && number === -1) number = 3; } else if (i === 2 && number === -1) number = 5; else if (i === 3 && number === -1) number = 9; clockDigits[i].value = number.toString(); return false; } function IncreaseTime(i, clickedButton) { clickedButton.style.borderBottomColor = "var(--pale-purple)"; setTimeout(function() { clickedButton.style.borderBottomColor = "var(--red)"; }, 150); let clockDigits = document.getElementsByClassName("clock-digit"); let number = parseInt(clockDigits[i].value) + 1; if (i == 0) { if (number == 3) number = 0; else if (number == 2) { let secondDigit = clockDigits[1].value; if (secondDigit > 3) clockDigits[1].value = "0"; } } else if (i == 1) { let firstDigit = parseInt(clockDigits[0].value); if (firstDigit < 2 && number == 10) number = 0; else if (firstDigit == 2 && number == 4) number = 0; } else if (i == 2 && number == 6) number = 0; else if (i == 3 && number == 10) number = 0; clockDigits[i].value = number.toString(); return false; } function RequestConnectionStatus(requestParams) { let xhttp = new XMLHttpRequest(); xhttp.onreadystatechange = function() { if (xhttp.readyState === 4) { let statusText = ""; if (xhttp.status === 200) statusText = xhttp.responseText; ToggleLoader(); ShowStatusPopup(statusText); } }; xhttp.open("POST", "/", true); xhttp.setRequestHeader("Content-Type", "application/x-www-form-urlencoded; charset=UTF-8"); xhttp.send(requestParams); } function RequestUserSettings() { let xhttp = new XMLHttpRequest(); xhttp.onreadystatechange = function() { if (this.readyState === 4 && this.status === 200) { let xmlDoc = this.responseXML; let daylightSavingCheckbox = document.getElementById("js-daylight-saving"); if (xmlDoc.getElementsByTagName("daylightSaving")[0].childNodes[0].nodeValue === "Active") daylightSavingCheckbox.checked = true; let sliderContainer = document.getElementById("js-slider-container"); if (xmlDoc.getElementsByTagName("brightnessControl")[0].childNodes[0].nodeValue !== "Auto") { sliderContainer.style.opacity = 1; sliderContainer.style.pointerEvents = "all"; document.getElementById("js-brightness-control").checked = false; } let sliderInput = document.getElementById("js-slider-input"); let sliderThumb = document.getElementById("js-slider-thumb"); sliderInput.value = xmlDoc.getElementsByTagName("manualBrightnessLevel")[0].childNodes[0].nodeValue; UpdateSlider(sliderInput, sliderThumb, sliderThumb.scrollWidth); let timeSyncCheckboxes = document.getElementsByClassName("js-time-sync-type"); let syncTimeWith = xmlDoc.getElementsByTagName("timeSetup")[0].childNodes[0].nodeValue.toLowerCase(); let checkString = "js-" + syncTimeWith + "-input"; for (let i = 0; i < timeSyncCheckboxes.length; i++) { if (timeSyncCheckboxes[i].id === checkString) timeSyncCheckboxes[i].checked = true; } } }; xhttp.open("GET", "/espSettings.xml", true); xhttp.setRequestHeader("Content-Type", "application/x-www-form-urlencoded; charset=UTF-8"); xhttp.send(); } function ShowAutoSettings() { document.getElementById("js-auto-set-option").style.backgroundColor = "#012341"; document.getElementById("js-manual-set-option").style.backgroundColor = "#384575"; document.getElementById("js-time-sync-mode").value = "auto"; let autoSettings = document.getElementById("js-auto-settings"); let manualSettings = document.getElementById("js-manual-settings"); manualSettings.style.opacity = "0"; setTimeout(function() { autoSettings.style.display = "block"; autoSettings.style.opacity = "1"; manualSettings.style.display = "none"; }, 300); } function ShowManualSettings() { document.getElementById("js-auto-set-option").style.backgroundColor = "#384575"; document.getElementById("js-manual-set-option").style.backgroundColor = "#012341"; document.getElementById("js-time-sync-mode").value = "manual"; let autoSettings = document.getElementById("js-auto-settings"); let manualSettings = document.getElementById("js-manual-settings"); autoSettings.style.opacity = "0"; setTimeout(function() { autoSettings.style.display = "none"; manualSettings.style.display = "block"; manualSettings.style.opacity = "1"; }, 300); } function ShowStatusPopup(popupText) { document.getElementById("js-popup-container").classList.add("show-popup"); document.getElementById("js-popup-message").innerText = popupText; } function SubmitChanges() { event.preventDefault(); event.stopPropagation(); ToggleLoader(); let autoSettingsInputs = document.getElementsByClassName("auto-settings-input"); let submitData = "ssid=" + autoSettingsInputs[0].value; submitData += "&pass=" + autoSettingsInputs[1].value; submitData += "&daylightSaving="; if (document.getElementById("js-daylight-saving").checked === true) submitData += "ON"; else submitData += "OFF"; submitData += "&brightnessControl="; if (document.getElementById("js-brightness-control").checked === true) submitData += "auto"; else submitData += "manual"; if (document.getElementById("js-time-sync-mode").value === "manual") { submitData += "&manualTimeValue="; for (let i = 0; i < 4; i++) submitData += document.getElementsByClassName("clock-digit")[i].value; } submitData += "&brightnessValue=" + document.getElementsByName("brightnessValue")[0].value; submitData += "&timeSyncMode=" + document.getElementById("js-time-sync-mode").value; submitData += "&setTimeWith="; let timeSyncType = document.getElementsByClassName("js-time-sync-type"); if (timeSyncType.length > 1) { if (timeSyncType[1].checked === true) submitData += "gps"; else submitData += "wifi"; } else submitData += "wifi"; RequestConnectionStatus(submitData); } function ToggleLoader() { let formContainers = document.getElementsByClassName("form-container"); for (let i = 0; i < formContainers.length; i++) { if (window.getComputedStyle(formContainers[i]).display === "inline-block") formContainers[i].style.display = "none"; else formContainers[i].style.display = "inline-block"; } } function TogglePasswordVisibility() { let passInput = document.getElementById("js-pass-input"); let showPasswordButton = document.getElementById("showPasswordButton"); let hidePasswordButton = document.getElementById("hide-password-button"); if (passInput.type === "password") { passInput.type = "text"; showPasswordButton.style.opacity = "0"; hidePasswordButton.style.opacity = "1"; } else { passInput.type = "password"; showPasswordButton.style.opacity = "1"; hidePasswordButton.style.opacity = "0"; } passInput.focus(); } function ToggleSliderInput() { let isChecked = document.getElementById("js-brightness-control").checked; let sliderContainer = document.getElementById("js-slider-container"); if (isChecked === true) { sliderContainer.style.opacity = 0; sliderContainer.style.pointerEvents = "none"; } else { sliderContainer.style.opacity = 1; sliderContainer.style.pointerEvents = "all"; } } function UpdateSlider(slider, thumb, thumbWidth) { let min = Number(slider.min); let max = Number(slider.max); let currentValue = Number(slider.value); let newX = (currentValue / (max - min)) * 100 > 100 ? 100 : (currentValue / (max - min)) * 100; thumb.style.left = `calc(${newX}% - ${thumbWidth / 2}px`; } 